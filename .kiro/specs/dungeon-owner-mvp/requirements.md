# 要件書

## 概要

「ダンジョンオーナー」は、プレイヤーがダンジョンの神となり、最深部のダンジョンコアを侵入者（RPGの人系キャラクター）から守るモバイル向けリアルタイム防衛ゲームです。縦画面での片手操作に最適化され、モンスターの配置と戦略的なダンジョン経営を通じて侵入者からコアを防衛します。

## 要件

### 要件1: 基本ゲームプレイ

**ユーザーストーリー:** プレイヤーとして、ダンジョンにモンスターを配置してダンジョンコアを防衛したい。そうすることで戦略的なリアルタイム防衛体験を楽しめる。

#### 受入基準

1. WHEN プレイヤーがモンスター配置モードを選択 THEN システムは購入可能なモンスターを表示 SHALL する
2. WHEN プレイヤーが階層の空きエリアをタップ THEN システムは選択したモンスターを配置 SHALL する
3. WHEN 侵入者が1階層の上り階段から出現 THEN システムは各階層でリアルタイム移動を開始 SHALL する
4. WHEN モンスターと侵入者が接触 THEN システムは戦闘判定を実行 SHALL する
5. WHEN 侵入者がダンジョンコアに到達 THEN システムはゲームオーバー状態に移行 SHALL する

### 要件2: リアルタイム戦闘システム

**ユーザーストーリー:** プレイヤーとして、モンスターと侵入者のリアルタイム戦闘を観察したい。そうすることで動的な戦闘体験を楽しめる。

#### 受入基準

1. WHEN モンスターと侵入者が接触 THEN システムは確率に基づいてダメージ判定を実行 SHALL する
2. WHEN 戦闘でダメージが発生 THEN システムは被ダメージ側を少し吹き飛ばす SHALL する
3. WHEN モンスターまたは侵入者のHPが0になる THEN システムは該当キャラクターを除去 SHALL する
4. WHEN 侵入者が撃破される THEN システムは金貨報酬を付与 SHALL する
5. WHEN 侵入者が撃破される THEN システムは低確率で罠アイテムをドロップ SHALL する

### 要件3: モンスター配置システム

**ユーザーストーリー:** プレイヤーとして、多様なモンスターを購入・配置して侵入者と戦わせたい。そうすることでより複雑な戦術を展開できる。

#### 受入基準

1. WHEN ゲーム開始時 THEN システムは1階層に自キャラクター1体と汎用モンスター14体を初期配置 SHALL する
2. WHEN 初期配置を実行 THEN システムはスライム5、レッサースケルトン3、レッサーゴースト3、レッサーゴーレム1、ゴブリン1、レッサーウルフ1を配置 SHALL する
3. WHEN 階層のモンスター数が15に達する THEN システムは追加配置を無効化 SHALL する
4. WHEN 階層を拡張 THEN システムは新しいモンスタータイプを購入可能にする SHALL する
5. WHEN モンスターのHPが0になる THEN システムはモンスターを除去 SHALL する

### 要件4: モンスターアビリティシステム

**ユーザーストーリー:** プレイヤーとして、各モンスターの固有アビリティを活用したい。そうすることで戦略的な多様性を楽しめる。

#### 受入基準

1. WHEN スライムが配置される THEN システムは自動体力回復速度上昇アビリティを付与 SHALL する
2. WHEN スケルトンまたはゴーストが撃破される THEN システムはレベルリセット後に一定時間で自動復活 SHALL する
3. WHEN 各モンスターが配置される THEN システムは固有アビリティを表示 SHALL する
4. WHEN アビリティが発動 THEN システムは視覚的エフェクトを表示 SHALL する
5. WHEN 復活可能モンスターが撃破される THEN システムは復活タイマーを開始 SHALL する

### 要件5: モンスター売却システム

**ユーザーストーリー:** プレイヤーとして、不要なモンスターを売却して金貨を回収したい。そうすることで効率的なリソース管理を行える。

#### 受入基準

1. WHEN 退避スポット内のモンスターを選択 THEN システムは売却オプションを表示 SHALL する
2. WHEN プレイヤーがモンスター売却を実行 THEN システムは購入価格の一定割合を金貨で返還 SHALL する
3. WHEN モンスターを売却 THEN システムは該当モンスターを完全に除去 SHALL する
4. WHEN 階層配置中のモンスター THEN システムは売却を無効化 SHALL する
5. WHEN 自キャラクター THEN システムは売却を無効化 SHALL する

### 要件6: ボスキャラシステム

**ユーザーストーリー:** プレイヤーとして、5階層ごとにボスキャラを配置したい。そうすることで強力な防衛ラインを構築できる。

#### 受入基準

1. WHEN 階層数が5の倍数に達する THEN システムはボスキャラ配置オプションを表示 SHALL する
2. WHEN プレイヤーがボスキャラを選択 THEN システムは選択式のボスキャラリストを表示 SHALL する
3. WHEN ボスキャラが配置される THEN システムは通常モンスターより高い戦闘力を付与 SHALL する
4. WHEN ボスキャラが撃破される THEN システムは一定時間後に同じ階層で再リポップ SHALL する
5. WHEN ボスキャラが再リポップ THEN システムは撃破時点のレベルを引き継ぎ SHALL する

### 要件7: 退避スポットシステム

**ユーザーストーリー:** プレイヤーとして、モンスターを階層間で移動させたい。そうすることで戦略的な配置変更を行える。

#### 受入基準

1. WHEN プレイヤーがモンスター移動を選択 THEN システムは退避スポットを表示 SHALL する
2. WHEN モンスターを退避スポットに移動 THEN システムは該当モンスターを階層から除去 SHALL する
3. WHEN 退避スポット内のモンスターを選択 THEN システムは配置可能な階層を表示 SHALL する
4. WHEN 退避スポットから階層に配置 THEN システムはモンスター配置制限を確認 SHALL する
5. WHEN 退避スポット内のモンスター THEN システムは時間経過でHP/MPを高速回復 SHALL する

### 要件8: 自キャラクターシステム

**ユーザーストーリー:** プレイヤーとして、自分のキャラクターを選択・配置して戦闘に参加させたい。そうすることで直接的な戦闘参加感を得られる。

#### 受入基準

1. WHEN ゲーム開始時 THEN システムは選択可能な自キャラクタータイプを表示 SHALL する
2. WHEN 自キャラクターを選択 THEN システムは1階層に初期配置を実行 SHALL する
3. WHEN 自キャラクターが撃破される THEN システムは一定時間後に退避スポットで蘇生 SHALL する
4. WHEN 自キャラクターが蘇生 THEN システムは撃破時点のレベルを引き継ぎ SHALL する
5. WHEN 自キャラクターが退避スポット内 THEN システムは時間経過でHP/MPを回復 SHALL する

### 要件9: HP/MP回復システム

**ユーザーストーリー:** プレイヤーとして、ダメージを受けたモンスターが時間経過で回復することを期待する。そうすることで持続的な戦闘が可能になる。

#### 受入基準

1. WHEN モンスターが階層に配置中 THEN システムは時間経過でHP/MPを緩やかに回復 SHALL する
2. WHEN モンスターが退避スポット内 THEN システムは時間経過でHP/MPを高速回復 SHALL する
3. WHEN 汎用モンスターが撃破される THEN システムはレベル引き継ぎを行わない SHALL する
4. WHEN ボスキャラまたは自キャラクターが撃破される THEN システムはレベルを保持 SHALL する
5. WHEN 回復中のモンスター THEN システムは回復状況を視覚的に表示 SHALL する

### 要件10: 階層・階段システム

**ユーザーストーリー:** プレイヤーとして、金貨を消費してダンジョンを深くしたい。そうすることで段階的な難易度上昇とより強い敵との戦闘を体験できる。

#### 受入基準

1. WHEN ゲーム開始時 THEN システムは初期3階層を生成 SHALL する
2. WHEN 各階層が生成される THEN システムは上り階段と下り階段を配置 SHALL する
3. WHEN 侵入者が1階層に出現 THEN システムは上り階段から侵入者を生成 SHALL する
4. WHEN プレイヤーが階層拡張を選択 THEN システムは現在の階層数に応じて増加する金貨コストを表示 SHALL する
5. WHEN 階層が深くなる THEN システムは侵入者のレベルを上昇させる SHALL する

### 要件11: 階層改装システム

**ユーザーストーリー:** プレイヤーとして、侵入者もモンスターも存在しない階層を自由に改装したい。そうすることで戦略的なダンジョンレイアウトを構築できる。

#### 受入基準

1. WHEN 階層に侵入者とモンスターが存在しない THEN システムは改装モードを有効化 SHALL する
2. WHEN プレイヤーが改装を実行 THEN システムは上り階段と下り階段の経路を確保 SHALL する
3. WHEN プレイヤーが階段を塞ぐ改装を試行 THEN システムは操作を無効化 SHALL する
4. WHEN 改装が完了 THEN システムは新しいレイアウトを保存 SHALL する
5. WHEN 改装中に侵入者またはモンスターが出現 THEN システムは改装モードを終了 SHALL する

### 要件12: 経済システム

**ユーザーストーリー:** プレイヤーとして、金貨を管理してモンスターの購入や階層拡張を行いたい。そうすることで戦略的なリソース配分を行える。

#### 受入基準

1. WHEN 侵入者を撃破 THEN システムは金貨報酬を付与 SHALL する
2. WHEN 1日の時間が経過 THEN システムは自動的に金貨を付与 SHALL する
3. WHEN プレイヤーがモンスターを購入 THEN システムは金貨コストを消費 SHALL する
4. WHEN プレイヤーが階層を拡張 THEN システムは階層数に比例して増加する金貨コストを消費 SHALL する
5. WHEN 金貨が不足 THEN システムは購入・拡張操作を無効化 SHALL する

### 要件13: 罠アイテムシステム

**ユーザーストーリー:** プレイヤーとして、侵入者を撃破して獲得した罠アイテムを使用したい。そうすることで戦闘を有利に進められる。

#### 受入基準

1. WHEN 侵入者を撃破 THEN システムは低確率で罠アイテムをドロップ SHALL する
2. WHEN プレイヤーが罠アイテムを使用 THEN システムは侵入者にのみダメージを与える SHALL する
3. WHEN 罠アイテムが発動 THEN システムは視覚的エフェクトを表示 SHALL する
4. WHEN 罠アイテムを使用 THEN システムはアイテムを消費 SHALL する
5. WHEN 複数の罠アイテムを所持 THEN システムはインベントリで管理 SHALL する

### 要件14: 時間制御システム

**ユーザーストーリー:** プレイヤーとして、ゲームの時間進行速度を調整したい。そうすることで自分のペースでゲームを楽しめる。

#### 受入基準

1. WHEN プレイヤーが速度制御ボタンを押下 THEN システムはゲーム速度を1x/1.5x/2xで切り替え SHALL する
2. WHEN ゲーム速度が変更される THEN システムは全てのゲーム要素に速度変更を適用 SHALL する
3. WHEN 倍速モード中 THEN システムは侵入者・モンスターの移動速度を調整 SHALL する
4. WHEN 倍速モード中 THEN システムは戦闘判定の頻度を調整 SHALL する
5. WHEN 速度変更時 THEN システムは現在の速度を視覚的に表示 SHALL する

### 要件15: ユーザーインターフェース

**ユーザーストーリー:** プレイヤーとして、縦画面で片手操作できるUIを使いたい。そうすることで快適にゲームをプレイできる。

#### 受入基準

1. WHEN プレイヤーがゲームを起動 THEN システムは縦画面レイアウトで表示 SHALL する
2. WHEN プレイヤーが片手でタップ操作 THEN システムは全ての機能にアクセス可能 SHALL する
3. WHEN プレイヤーがモンスター配置時 THEN システムはゴースト表示と配置可能エリア表示を提供 SHALL する
4. WHEN リアルタイム戦闘中 THEN システムは戦闘状況を視覚的に表示 SHALL する
5. WHEN 改装モード中 THEN システムは改装可能エリアをハイライト表示 SHALL する

### 要件16: データ永続化

**ユーザーストーリー:** プレイヤーとして、ゲームの進行状況が自動保存されることを期待する。そうすることで安心してゲームを中断・再開できる。

#### 受入基準

1. WHEN 侵入者を撃破 THEN システムは金貨とアイテム獲得状況を自動保存 SHALL する
2. WHEN プレイヤーがゲームを終了 THEN システムは現在の状態を保存 SHALL する
3. WHEN プレイヤーがゲームを再開 THEN システムは保存された状態を復元 SHALL する
4. WHEN 階層拡張やモンスター配置が変更 THEN システムは永続データを更新 SHALL する
5. WHEN セーブデータが破損 THEN システムは初期状態からの再開を提供 SHALL する

### 要件17: レベルシステム

**ユーザーストーリー:** プレイヤーとして、モンスターと侵入者のレベルシステムを理解したい。そうすることで戦略的な判断を行える。

#### 受入基準

1. WHEN モンスターを配置 THEN システムはモンスターのレベルを表示 SHALL する
2. WHEN 侵入者が出現 THEN システムは侵入者のレベルを表示 SHALL する
3. WHEN レベル差がある戦闘 THEN システムはレベル差を戦闘計算に反映 SHALL する
4. WHEN 階層が深くなる THEN システムは侵入者レベルを段階的に上昇 SHALL する
5. WHEN 高レベル侵入者を撃破 THEN システムはより多くの金貨を付与 SHALL する

### 要件18: 侵入者出現システム

**ユーザーストーリー:** プレイヤーとして、予測不可能なタイミングで侵入者が現れることで緊張感を味わいたい。そうすることでリアルタイム戦略の面白さを体験できる。

#### 受入基準

1. WHEN ゲームが開始される THEN システムはランダムなタイミングで侵入者を生成 SHALL する
2. WHEN 侵入者が出現 THEN システムは連続出現を防止 SHALL する
3. WHEN 階層が深くなる THEN システムは侵入者をパーティ単位で出現させる SHALL する
4. WHEN 階層が深い THEN システムは侵入者出現頻度を調整 SHALL する
5. WHEN 侵入者が1階層の上り階段から出現 THEN システムは視覚的な出現エフェクトを表示 SHALL する

### 要件19: パーティシステム

**ユーザーストーリー:** プレイヤーとして、モンスターをパーティ編成して協力戦闘させたい。そうすることでより戦略的な戦闘を楽しめる。

#### 受入基準

1. WHEN プレイヤーがモンスターパーティを設定 THEN システムは同じ行動パターンで移動させる SHALL する
2. WHEN パーティメンバーが戦闘に参加 THEN システムはダメージをパーティ全員で負担 SHALL する
3. WHEN パーティ内に回復スキル持ちが存在 THEN システムはパーティメンバーに回復スキルを適用 SHALL する
4. WHEN 侵入者パーティが出現 THEN システムは協力戦闘を実行 SHALL する
5. WHEN パーティメンバーが撃破される THEN システムは残りメンバーでパーティを継続 SHALL する

### 要件20: チュートリアル

**ユーザーストーリー:** 新規プレイヤーとして、基本操作を学べる簡易チュートリアルを受けたい。そうすることでゲームの仕組みを理解できる。

#### 受入基準

1. WHEN 初回起動時 THEN システムはチュートリアルモードを開始 SHALL する
2. WHEN チュートリアル中 THEN システムは段階的に操作方法を説明 SHALL する
3. WHEN プレイヤーが指定操作を完了 THEN システムは次のステップに進行 SHALL する
4. WHEN チュートリアル完了 THEN システムは通常ゲームモードに移行 SHALL する
5. WHEN プレイヤーがスキップを選択 THEN システムはチュートリアルを終了 SHALL する